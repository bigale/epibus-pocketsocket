<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé≠ AI-Kit Character Simulator Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .btn.start { background: rgba(34, 197, 94, 0.3); }
        .btn.stop { background: rgba(239, 68, 68, 0.3); }
        .btn.refresh { background: rgba(59, 130, 246, 0.3); }

        .simulators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .simulator-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .simulator-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .character-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .character-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .kyoko { background: linear-gradient(135deg, #6a5b7b, #9b8aa0); }
        .byakuya { background: linear-gradient(135deg, #1e3a8a, #3b82f6); }
        .chihiro { background: linear-gradient(135deg, #166534, #22c55e); }
        .celestia { background: linear-gradient(135deg, #991b1b, #ef4444); }
        .sakura { background: linear-gradient(135deg, #ea580c, #f97316); }

        .character-info h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .character-info p {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-running { background: #22c55e; box-shadow: 0 0 10px #22c55e; }
        .status-stopped { background: #ef4444; }
        .status-error { background: #f59e0b; }

        .simulator-details {
            margin-top: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .detail-label {
            opacity: 0.8;
        }

        .detail-value {
            font-weight: 600;
        }

        .simulator-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.8rem;
            border-radius: 6px;
            flex: 1;
        }

        .link-btn {
            background: rgba(59, 130, 246, 0.3);
            color: white;
            text-decoration: none;
            display: inline-block;
        }

        .stats-section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
        }

        .error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulsing {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé≠ AI-Kit Character Simulator Dashboard</h1>
            <p>Monitor and manage your Node-RED character-driven PLC simulators</p>
        </div>

        <div class="controls">
            <button class="btn start" onclick="startAllSimulators()">üöÄ Start All</button>
            <button class="btn stop" onclick="stopAllSimulators()">üõë Stop All</button>
            <button class="btn refresh" onclick="refreshStatus()">üîÑ Refresh</button>
            <button class="btn" onclick="createCollaborativeScenario()">ü§ù Collaborate</button>
            <button class="btn" onclick="viewLogs()">üìã View Logs</button>
        </div>

        <div id="content">
            <div class="loading pulsing">Loading simulator status...</div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api'; // Assuming API server on 3000
        
        const characters = {
            kyoko: { 
                name: 'Kyoko Kirigiri', 
                role: 'Detective & Anomaly Investigator',
                port: 1881,
                modbus: 5020,
                emoji: 'üïµÔ∏è'
            },
            byakuya: { 
                name: 'Byakuya Togami', 
                role: 'Efficiency & Performance Optimizer',
                port: 1882,
                modbus: 5021,
                emoji: 'üíº'
            },
            chihiro: { 
                name: 'Chihiro Fujisaki', 
                role: 'Technical Integration Specialist',
                port: 1883,
                modbus: 5022,
                emoji: 'üíª'
            },
            celestia: { 
                name: 'Celestia Ludenberg', 
                role: 'UI/UX & Aesthetic Designer',
                port: 1884,
                modbus: 5023,
                emoji: 'üé®'
            },
            sakura: { 
                name: 'Sakura Ogami', 
                role: 'Stress Testing & Reliability',
                port: 1885,
                modbus: 5024,
                emoji: 'üí™'
            }
        };

        async function fetchSimulatorStatus() {
            try {
                // For demo purposes, simulate status
                return {
                    simulators: Object.keys(characters).map(id => ({
                        character: id,
                        status: Math.random() > 0.3 ? 'running' : 'stopped',
                        port: characters[id].port,
                        uptime: Math.floor(Math.random() * 86400000),
                        url: `http://localhost:${characters[id].port}`,
                        dashboardUrl: `http://localhost:${characters[id].port}/ui`,
                        apiUrl: `http://localhost:${characters[id].port}/api`
                    })),
                    total: Object.keys(characters).length,
                    running: 0,
                    stopped: 0,
                    error: 0
                };
            } catch (error) {
                console.error('Failed to fetch status:', error);
                throw error;
            }
        }

        function formatUptime(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (days > 0) return `${days}d ${hours % 24}h`;
            if (hours > 0) return `${hours}h ${minutes % 60}m`;
            if (minutes > 0) return `${minutes}m ${seconds % 60}s`;
            return `${seconds}s`;
        }

        function renderSimulators(data) {
            const content = document.getElementById('content');
            
            // Update counts
            data.running = data.simulators.filter(s => s.status === 'running').length;
            data.stopped = data.simulators.filter(s => s.status === 'stopped').length;
            data.error = data.simulators.filter(s => s.status === 'error').length;

            content.innerHTML = `
                <div class="stats-section">
                    <h2>üìä System Overview</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" style="color: #22c55e">${data.running}</div>
                            <div class="stat-label">Running</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" style="color: #ef4444">${data.stopped}</div>
                            <div class="stat-label">Stopped</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" style="color: #f59e0b">${data.error}</div>
                            <div class="stat-label">Errors</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${data.total}</div>
                            <div class="stat-label">Total Simulators</div>
                        </div>
                    </div>
                </div>

                <div class="simulators-grid">
                    ${data.simulators.map(sim => {
                        const char = characters[sim.character];
                        const statusClass = `status-${sim.status}`;
                        
                        return `
                            <div class="simulator-card">
                                <div class="character-header">
                                    <div class="character-avatar ${sim.character}">
                                        ${char.emoji}
                                    </div>
                                    <div class="character-info">
                                        <h3>${char.name}</h3>
                                        <p>${char.role}</p>
                                    </div>
                                </div>
                                
                                <div class="simulator-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Status:</span>
                                        <span class="detail-value">
                                            <span class="status-indicator ${statusClass}"></span>
                                            ${sim.status.toUpperCase()}
                                        </span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Port:</span>
                                        <span class="detail-value">${sim.port}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">MODBUS:</span>
                                        <span class="detail-value">${char.modbus}</span>
                                    </div>
                                    ${sim.status === 'running' ? `
                                    <div class="detail-row">
                                        <span class="detail-label">Uptime:</span>
                                        <span class="detail-value">${formatUptime(sim.uptime)}</span>
                                    </div>
                                    ` : ''}
                                </div>

                                <div class="simulator-actions">
                                    ${sim.status === 'running' ? `
                                        <button class="btn btn-small stop" onclick="stopSimulator('${sim.character}')">Stop</button>
                                        <a href="${sim.dashboardUrl}" target="_blank" class="btn btn-small link-btn">Dashboard</a>
                                    ` : `
                                        <button class="btn btn-small start" onclick="startSimulator('${sim.character}')">Start</button>
                                    `}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        async function refreshStatus() {
            try {
                const data = await fetchSimulatorStatus();
                renderSimulators(data);
            } catch (error) {
                document.getElementById('content').innerHTML = `
                    <div class="error">
                        <h3>‚ö†Ô∏è Failed to load simulator status</h3>
                        <p>Make sure the simulator manager is running and accessible.</p>
                        <button class="btn" onclick="refreshStatus()">Try Again</button>
                    </div>
                `;
            }
        }

        async function startSimulator(character) {
            try {
                // Simulate API call
                console.log(`Starting ${character} simulator...`);
                await new Promise(resolve => setTimeout(resolve, 1000));
                refreshStatus();
            } catch (error) {
                alert(`Failed to start ${character} simulator: ${error.message}`);
            }
        }

        async function stopSimulator(character) {
            try {
                // Simulate API call
                console.log(`Stopping ${character} simulator...`);
                await new Promise(resolve => setTimeout(resolve, 1000));
                refreshStatus();
            } catch (error) {
                alert(`Failed to stop ${character} simulator: ${error.message}`);
            }
        }

        async function startAllSimulators() {
            try {
                console.log('Starting all simulators...');
                await new Promise(resolve => setTimeout(resolve, 2000));
                refreshStatus();
            } catch (error) {
                alert(`Failed to start all simulators: ${error.message}`);
            }
        }

        async function stopAllSimulators() {
            try {
                console.log('Stopping all simulators...');
                await new Promise(resolve => setTimeout(resolve, 2000));
                refreshStatus();
            } catch (error) {
                alert(`Failed to stop all simulators: ${error.message}`);
            }
        }

        function createCollaborativeScenario() {
            const scenarioName = prompt('Enter scenario name:', 'multi_character_investigation');
            if (scenarioName) {
                console.log(`Creating collaborative scenario: ${scenarioName}`);
                // Simulate API call
                alert(`Collaborative scenario "${scenarioName}" created successfully!`);
            }
        }

        function viewLogs() {
            // Open logs in a new window (would need a logs endpoint)
            window.open('/logs', '_blank');
        }

        // Auto-refresh every 30 seconds
        setInterval(refreshStatus, 30000);

        // Initial load
        refreshStatus();
    </script>
</body>
</html>
